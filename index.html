<script>
  // ===== Replace with your Firebase web app config =====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  // =====================================================

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const buttons = [1,2,3];

  buttons.forEach(num => {
    const btn = document.getElementById(`button${num}`);
    const countEl = document.getElementById(`count${num}`);
    const timeEl = document.getElementById(`time${num}`);
    const ref = db.ref(`buttons/button${num}`);
    const historyRef = db.ref("history");

    // Listen for realtime updates
    ref.on('value', snapshot => {
      const data = snapshot.val() || {};
      const count = data.count || 0;
      const ts = data.lastClick || null;

      countEl.textContent = `Clicked ${count} time${count === 1 ? '' : 's'}`;

      if (ts) {
        const d = new Date(ts);
        timeEl.textContent = `Last clicked: ${d.toLocaleString()}`;
      } else {
        timeEl.textContent = '';
      }
    });

    // On click â†’ increment + log event
    btn.addEventListener('click', () => {
      const now = firebase.database.ServerValue.TIMESTAMP;

      // 1) Increment counter using a transaction
      ref.transaction(current => {
        if (!current) {
          return { count: 1, lastClick: now };
        }
        return {
          count: (current.count || 0) + 1,
          lastClick: now
        };
      });

      // 2) Add a new record to history
      historyRef.push({
        btn: num,
        ts: firebase.database.ServerValue.TIMESTAMP
      });
    });
  });
</script>
